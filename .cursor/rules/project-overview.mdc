---
description: Core project context for Found dating app
alwaysApply: true
---

# Found - AI Matchmaking Dating App

AI matchmaking app for serious partnerships. Voice-first onboarding with 9 open-ended questions. AI extracts structured profiles via Whisper + GPT. Two-tier matching: rule-based pre-filter (`lib/matching.ts`) then AI compatibility analysis (`convex/actions/analyzeCompatibility.ts`) with per-pair GPT scoring, flags, and summary stored in `compatibilityAnalyses` table.

## Tech Stack

- React Native + Expo SDK 54, Expo Router (file-based routing)
- Convex (real-time backend, no migrations)
- Clerk (phone/SMS auth)
- OpenAI API (gpt-5-mini-2025-08-07)
- MMKV v3 + Zustand (offline storage)
- TypeScript, Bun (package manager)

## Project Structure

```
app/                    # Expo Router screens
├── index.tsx           # Landing page (pre-auth)
├── _layout.tsx         # Root layout with AuthGate, fonts, splash
├── (auth)/             # sign-in.tsx, verify.tsx
├── (onboarding)/       # basics screens (use BasicOptionScreen or useBasicsStep), basics-summary.tsx, voice-questions.tsx
├── (tabs)/             # Dynamic tabs based on completion state
│   ├── _layout.tsx     # Tab config: hides/shows tabs based on voice question completion
│   ├── questions.tsx   # Voice questions checklist (visible before questions complete)
│   ├── matches.tsx     # Browse matches (visible after questions complete)
│   ├── chats.tsx       # Chats placeholder (visible after questions complete)
│   ├── settings.tsx    # Profile/settings tab (always visible)
│   ├── waitlist.tsx    # Waitlist screen with shareable profile card
│   └── journey.tsx     # Journey screen (hidden, for future use)
├── profile.tsx         # Profile modal (legacy, kept for compat)
├── my-profile.tsx      # View own profile modal
└── mini-profile.tsx    # Shareable mini profile (full-page view + share button)
convex/                 # Backend: schema, mutations, queries, actions
components/             # Reusable UI components
lib/                    # Utilities, theme, matching algorithm
hooks/                  # Custom React hooks
stores/                 # Zustand stores
```

## Critical Conventions

- **Convex does NOT auto-sync.** After ANY change to `convex/` files, the AI must run `bunx convex dev` once to push. `convex dev` is not kept running in a separate terminal -- just run it once after changes and let it complete.
- **Auth is server-side.** Convex functions use `ctx.auth.getUserIdentity()` to identify the caller. Do NOT pass `clerkId` as a function argument. Client queries use `userId ? {} : "skip"` to gate on sign-in state.
- Always reference questions by `questionKey`, never by `order` number.
- All screens use `useEffectiveUserId()` instead of `useAuth()` directly (gates query skipping).
- Env: `EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY`, `EXPO_PUBLIC_CONVEX_URL` in `.env.local`; `OPENAI_API_KEY`, `CLERK_JWT_ISSUER_DOMAIN` set via `bunx convex env set`.

## Running the App

```bash
bun install
bunx convex dev          # Run once after any convex/ changes to push
bun start                # Press 'i' for iOS simulator
```

## Seeding Test Users

Use the voice pipeline in `convex/actions/seedVoiceTestUsers.ts` (not the legacy `seedTestUsers.ts`):

```bash
bunx convex run actions/seedVoiceTestUsers:seedCelebProfiles       # 10 celebs
bunx convex run actions/seedVoiceTestUsers:seedHighCompatUsers     # 3 high-compat
bunx convex run actions/seedTestPhotos:seedCelebPhotos             # Photos (separate step)
bunx convex run seedTestUsers:deleteAllBots                        # Wipe all bots
```

## Shareable Mini Profile

Screenshot-friendly profile card showing AI-generated profile data. Purely frontend — no backend changes needed, all data comes from existing `users`, `userProfiles`, and `photos` tables.

### Files
- `components/ShareableProfileCard.tsx` — Reusable card component with two variants:
  - `"card"` (default): White card with shadow, short bio quote, watermark. Used on waitlist.
  - `"fullPage"`: No card chrome, close button hidden during capture. Used in mini-profile screen.
- `app/mini-profile.tsx` — Full-page view with floating "Share Profile" button. Accessible from Settings > "View Mini Profile" (gated behind `questionsComplete`).
- `app/(tabs)/waitlist.tsx` — Shows the card variant + share button + countdown/referral below.

### Share Flow
Uses `react-native-view-shot` (`captureRef`) to capture the card as a PNG image. During capture, `capturing` prop flips to `true` which: (1) adds white background, (2) hides the close button. The captured image is shared via the native share sheet.

### Card Content (all from existing profile data)
- "Found. The AI Matchmaker." header
- Photo + name/age + location
- Basics at a glance (height, hometown, kids, pets, ethnicity, religion, politics, relationship goal) — wrapping row with dot separators
- Matchmaker's note (`generatedBio`)
- What defines them: raw values + passions (blue pills, prefers non-canonical freeform values)
- Looking for: must-haves (green pills)
- Dealbreakers (red pills, separate labeled section)
