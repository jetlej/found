---
description: Expo Router navigation patterns and auth flow
globs: app/**/*.tsx
alwaysApply: false
---

# Navigation Conventions

- Use `router.replace()` for auth redirects and when navigation history may be empty
- Use `router.push()` for normal navigation within a flow
- Use `router.back()` only when certain there's navigation history
- Auth flow handled in `app/_layout.tsx` via `AuthGate` component
- Onboarding uses `router.replace()` for back navigation to avoid errors when history is empty
- Onboarding step saved to database (`onboardingStep` field) for resume on app restart
- Onboarding supports **editing mode** (`editing=true` param): entered from Questions tab, shows X button to close, skips `setOnboardingStep`, carries `editing` param via `goToNextStep(router, step, isEditing)`

## Dev Admin Panel (DEV MODE ONLY)

- Long-press center-top of any screen for 3 seconds to open
- `components/DevTrigger.tsx` + `components/DevAdminPanel.tsx`
- Supports user search and fresh test user creation
- Dev impersonation is **read-only**: `devClerkId` in `stores/offline.ts` swaps which user the UI displays, but Convex mutations always act as the real authenticated user (identity comes from the JWT)
- `hooks/useEffectiveUserId.ts`: returns `devClerkId` when impersonating (for query gating), otherwise real Clerk userId
