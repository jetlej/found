---
description: Database schema reference for all Convex tables
globs: convex/schema.ts, convex/**
alwaysApply: false
---

# Database Schema (Convex)

## users
- `clerkId`: string (index: `by_clerk_id`), `phone`: string (index: `by_phone`)
- `name`, `avatarUrl`, `gender` ("Man"/"Woman"/"Non-binary"), `location`, `sexuality` ("Men"/"Women"/"Everyone"): optional strings
- `birthdate`: optional string (ISO date), `ageRangeMin`, `ageRangeMax`: optional numbers (preferred partner age range), `ageRangeDealbreaker`: optional boolean (hard filter when true)
- `heightInches`: optional number
- `onboardingComplete`: optional boolean, `onboardingStep`: optional string ("basics"/"photos")
- `onboardingType`: optional "journey" | "voice"
- `type`: optional "human" | "bot" — real users get "human", seeded test users get "bot"
- `level`: optional number (1-6), `completedCategories`: optional string[]
- `waitlistPosition`, `pushToken`, `notificationsEnabled`, `reminderHour`, `reminderMinute`: optional
- `profileAuditCompletedAt`: optional number — timestamp when user first completed profile audit (gates routing to matches)
- `lastProfileEditedAt`: optional number — updated on every `updateBasics`/`updateProfile` call
- `lastProfileRegeneratedAt`: optional number — updated when regenerate profile runs (cooldown reference)

## photos
- `userId`: Id<"users">, `storageId`: Id<"_storage">, `url`: string, `order`: number (0-5)
- Index: `by_user`

## questions
- `order`: number (1-91), `questionKey`: string (stable identifier), `text`: string
- `type`: "multiple_choice" | "text" | "essay" | "scale" | "range" | "checklist" | "interest_picker"
- `options`: optional string[], `category`: optional string
- `scaleMin`, `scaleMax`: optional number; `scaleMinLabel`, `scaleMaxLabel`: optional string
- `linkedQuestionKey`: optional string, `hasDealbreaker`: optional boolean
- Indexes: `by_order`, `by_key`

## answers
- `userId`: Id<"users">, `questionId`: Id<"questions">
- `value`: string (format varies: plain string, number string, JSON object `{"min","max"}`, JSON array)
- `source`: optional "ai" | "manual", `isDealbreaker`: optional boolean
- Indexes: `by_user`, `by_user_question`

## voiceRecordings
- `userId`: Id<"users">, `questionIndex`: number (0-8)
- `storageId`: Id<"_storage">, `durationSeconds`: number
- `transcription`: optional string, `createdAt`: number (timestamp)
- Indexes: `by_user`, `by_user_question`

## config
- `key`: string (index: `by_key`), `value`: string

## userProfiles (AI-extracted structured data)
- `userId`: Id<"users"> (index: `by_user`)
- `selectedInterests`: optional string[], `canonicalValues`: optional string[]
- `preferences`: optional object with keys: `relationshipGoals`, `relationshipStyle`, `hasChildren`, `wantsChildren`, `ethnicity`, `religion`, `politics`, `education`, `alcohol`, `smoking`, `marijuana`, `drugs` -- each `{ self: string, openTo: string[], isDealbreaker: boolean }`
- `values`, `interests`, `dealbreakers`: string[] (legacy display fields)
- `traits`: 11 dimensions (1-10): introversion, adventurousness, ambition, emotionalOpenness, traditionalValues, independenceNeed, romanticStyle, socialEnergy, communicationStyle, attachmentStyle, planningStyle
- `relationshipStyle`: loveLanguage, conflictStyle, communicationFrequency, financialApproach, aloneTimeNeed
- `familyPlans`: wantsKids, kidsTimeline, familyCloseness, parentingStyle
- `lifestyle`: sleepSchedule, exerciseLevel, dietType, alcoholUse, drugUse, petPreference, locationPreference
- Narrative sections: lifeStory, socialProfile, intimacyProfile, lovePhilosophy, partnerPreferences, bioElements, demographics, health
- Generated: `generatedBio`, `shortBio`, `keywords`: string[], `processedAt`, `openaiModel`, `confidence`

## compatibilityAnalyses (AI-generated per-pair compatibility)
- `userIdPair`: string — sorted "id1_id2" for dedup (index: `by_pair`)
- `user1Id`: Id<"users"> (index: `by_user1`), `user2Id`: Id<"users"> (index: `by_user2`)
- `summary`: string, `greenFlags`: string[], `yellowFlags`: string[], `redFlags`: string[]
- `categoryScores`: object with 10 number fields (coreValues, lifestyleAlignment, relationshipGoals, communicationStyle, emotionalCompatibility, familyPlanning, socialLifestyle, conflictResolution, intimacyAlignment, growthMindset)
- `overallScore`: number (0-100, sum of categories with dealbreaker penalty)
- `generatedAt`: number (timestamp), `openaiModel`: string
